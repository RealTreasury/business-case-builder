jQuery(function(r){function t(){r.post(rtbcbWorkflow.ajax_url,{action:"rtbcb_get_workflow_history",nonce:rtbcbWorkflow.nonce}).done(function(t){if(t.success){var o=t.data.history||[];if(!o.length)return r("#rtbcb-workflow-history-container").html("<p>"+rtbcbWorkflow.strings.no_history+"</p>"),void alert(rtbcbWorkflow.strings.refresh_success);var n=[];o.forEach(function(r){r.steps&&r.steps.forEach(function(r){-1===n.indexOf(r.name)&&n.push(r.name)})});var c="<table><thead><tr><th>"+rtbcbWorkflow.strings.lead+"</th>";n.forEach(function(t){c+="<th>"+r("<div>").text(t).html()+"</th>"}),c+="</tr></thead><tbody>",o.forEach(function(t){var o=t.email||(t.lead_id?"ID "+t.lead_id:rtbcbWorkflow.strings.unknown_lead);c+="<tr><td>"+r("<div>").text(o).html()+"</td>",n.forEach(function(o){var n=rtbcbWorkflow.strings.not_run;t.steps&&t.steps.forEach(function(r){r.name===o&&(n=r.status)}),c+="<td>"+r("<div>").text(n).html()+"</td>"}),c+="</tr>"}),c+="</tbody></table>",r("#rtbcb-workflow-history-container").html(c),alert(rtbcbWorkflow.strings.refresh_success)}else alert(rtbcbWorkflow.strings.error)}).fail(function(){alert(rtbcbWorkflow.strings.error)})}r("#rtbcb-refresh-workflow").on("click",function(){t()}),r("#rtbcb-clear-workflow").on("click",function(){r.post(rtbcbWorkflow.ajax_url,{action:"rtbcb_clear_workflow_history",nonce:rtbcbWorkflow.nonce}).done(function(t){t.success?(r("#rtbcb-workflow-history-container").empty(),alert(rtbcbWorkflow.strings.clear_success)):alert(rtbcbWorkflow.strings.error)}).fail(function(){alert(rtbcbWorkflow.strings.error)})}),t()});