jQuery(function(r){function t(t,o){r("#rtbcb-workflow-message").removeClass("notice-success notice-error").addClass("notice-"+o).text(t).show()}function o(o){r.post(rtbcbWorkflow.ajax_url,{action:"rtbcb_get_workflow_history",nonce:rtbcbWorkflow.nonce}).done(function(s){if(s.success){var c=s.data.history||[];if(!c.length)return r("#rtbcb-workflow-history-container").html("<p>"+rtbcbWorkflow.strings.no_history+"</p>"),void(o&&t(rtbcbWorkflow.strings.refresh_success,"success"));var n=[];c.forEach(function(r){r.steps&&r.steps.forEach(function(r){-1===n.indexOf(r.name)&&n.push(r.name)})});var e='<div class="rtbcb-history-table-wrapper"><table class="widefat rtbcb-history-table"><thead><tr><th>'+rtbcbWorkflow.strings.lead+"</th>";n.forEach(function(t){e+="<th>"+r("<div>").text(t).html()+"</th>"}),e+="</tr></thead><tbody>",c.forEach(function(t){var o=t.email||(t.lead_id?"ID "+t.lead_id:rtbcbWorkflow.strings.unknown_lead);e+="<tr><td>"+r("<div>").text(o).html()+"</td>",n.forEach(function(o){var s=rtbcbWorkflow.strings.not_run,c="";t.steps&&t.steps.forEach(function(r){r.name===o&&(s=r.status,r.duration&&(c='<span class="rtbcb-step-time">'+r.duration+rtbcbWorkflow.strings.seconds+"</span>"))}),e+="<td><span>"+r("<div>").text(s).html()+"</span>"+c+"</td>"}),e+="</tr>"}),e+="</tbody></table></div>",r("#rtbcb-workflow-history-container").html(e),o&&t(rtbcbWorkflow.strings.refresh_success,"success")}else t(rtbcbWorkflow.strings.error,"error")}).fail(function(){t(rtbcbWorkflow.strings.error,"error")})}r("#rtbcb-refresh-workflow").on("click",function(){o(!0)}),r("#rtbcb-clear-workflow").on("click",function(){r.post(rtbcbWorkflow.ajax_url,{action:"rtbcb_clear_workflow_history",nonce:rtbcbWorkflow.nonce}).done(function(o){o.success?(r("#rtbcb-workflow-history-container").empty(),t(rtbcbWorkflow.strings.clear_success,"success")):t(rtbcbWorkflow.strings.error,"error")}).fail(function(){t(rtbcbWorkflow.strings.error,"error")})}),o(!1)});